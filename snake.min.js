!function(){function e(){if(!a&&(a=!0,s)){for(var e=0;e<s.length;e++)s[e].call(window,[])
s=[]}}function t(e){if("function"!=typeof window.onload)window.onload=e
else{var t=window.onload
window.onload=function(){oldonload&&t(),e()}}}function n(){i||(i=!0,document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):document.attachEvent?(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),e())}),document.documentElement.doScroll&&window==window.top&&function(){if(!a){try{document.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()):t(e))}window.Ready={}
var i=!1,a=!1,s=[]
Ready.run=function(e,t){a?e.call(window,[]):(n(),s.push(function(){return e.call(window,[])}))},n()}()
var snakeGame={}
Ready.run(function(){snakeGame.controller.init()}),snakeGame.Coord=function(e,t,n){this.x=e,this.y=t,this.value=n||null,this.toPropKey=function(){return this.x+"_"+this.y}},snakeGame.TouchListener=function(e,t,n){if(!(this instanceof snakeGame.TouchListener))return new snakeGame.TouchListener(e,t,n)
var i,a,s,o,r,d,h,c=150,u=500,l=this
this.touchStart=function(e){var t=e.changedTouches[0]
r=0,i=t.pageX,a=t.pageY,h=(new Date).getTime(),e.preventDefault()},this.touchMove=function(e){e.preventDefault()},this.touchEnd=function(m){var p=m.changedTouches[0]
s=p.pageX-i,o=p.pageY-a,r=Math.max(Math.abs(s),Math.abs(o)),d=(new Date).getTime()-h,u>=d&&r>c&&(n&&(e.removeEventListener("touchstart",l.touchStart),e.removeEventListener("touchmove",l.touchMove),e.removeEventListener("touchend",l.touchEnd)),t(Math.abs(s)>Math.abs(o)?0>s?"left":"right":0>o?"up":"down"))},e.addEventListener("touchstart",this.touchStart,!1),e.addEventListener("touchmove",this.touchMove,!1),e.addEventListener("touchend",this.touchEnd,!1)},snakeGame.KeyboardListener=function(e,t){if(!(this instanceof snakeGame.KeyboardListener))return new snakeGame.KeyboardListener(e,t)
var n=this
this.listener=function(i){var a={37:"left",38:"up",39:"right",40:"down",65:"left",87:"up",83:"down",68:"right"}[i.which||i.keyCode]
a&&(t&&document.removeEventListener("keyup",n.listener),e(a))},document.addEventListener("keyup",this.listener)},snakeGame.ButtonListener=function(e,t,n){if(!(this instanceof snakeGame.ButtonListener))return new snakeGame.ButtonListener(e,t,n)
var i=this
this.listener=function(e){var a=e.target.getAttribute("direction")
a&&(n&&(document.removeEventListener("click",i.listener),document.removeEventListener("touchstart",i.listener)),t(a))},document.addEventListener("click",this.listener),document.addEventListener("touchstart",this.listener)},snakeGame.boardModel={init:function(e,t){this.size=e||25,this.changedCells=[],this._setupNewBoard(this.size,t)},_setupNewBoard:function(e,t){this._newBoard(e)._addSnake(t)._placeFood()},_addSnake:function(e){for(i=0;i<e.length;i++)this.grid[e[i].toPropKey()]=e[i]
return this},_newBoard:function(e){this.grid={}
for(var t=0;e>t;t++)for(var n=0;e>n;n++)this.grid[t+"_"+n]=new snakeGame.Coord(t,n)
return this},coordToKey:function(e,t){return e+"_"+t},checkNextPosition:function(e){e=this.grid[this.coordToKey(e.x,e.y)]
var t=e?e.value:null
return e&&"snake"!==t?(e.value="snake",this.changedCells.push(e),"food"===t?(this._placeFood(),"grow"):void 0):"crash"},_placeFood:function(){var e
do e=this.grid[this._randomCell()]
while("snake"===e.value)
return e.value="food",this.changedCells.push(e),this},_randomCell:function(){return this.coordToKey(Math.floor(Math.random()*this.size),Math.floor(Math.random()*this.size))},unset:function(e){e&&(this.grid[e.toPropKey()].value=null,this.changedCells.push(this.grid[e.toPropKey()]))}},snakeGame.snakeModel={init:function(e){e=e||0,this.snakeHead={x:Math.floor(e/2),y:Math.floor(e/2),d:{x:0,y:0}},this.snakeBody=[],this.changes=[],this._moveHead()},_moveHead:function(){return this.snakeBody.unshift(new snakeGame.Coord(this.snakeHead.x,this.snakeHead.y,"snake"))},_moveTail:function(){return this.snakeBody.pop()},nextPostion:function(){return{x:this.snakeHead.x+this.snakeHead.d.x,y:this.snakeHead.y+this.snakeHead.d.y}},_setNextPosition:function(){var e=this.nextPostion()
this.snakeHead.x=e.x,this.snakeHead.y=e.y},move:function(e){this._setNextPosition(),this._moveHead()
var t
return e||(t=this._moveTail()),t},changeDirection:function(){if(this.changes.length>0){var e=this.changes.shift()
this.snakeHead.d.x=e.x||0,this.snakeHead.d.y=e.y||0}},addDirChange:function(e){e.x===this.snakeHead.d.x&&e.y===this.snakeHead.d.y||0!==this.changes.length&&e.x===this.changes[this.changes.length-1].x&&e.y===this.changes[this.changes.length-1].y||console.log("changed"),this.changes.push(e)}},snakeGame.view={init:function(e){this.snakeWrapper=document.getElementsByTagName("snake-game")[0]||this.createWrapper(),this.gameWrapper=this.snakeWrapper.getElementsByTagName("game-display")[0]||this.createGameWrapper(),this.buttonWrapper=this.snakeWrapper.getElementsByTagName("game-buttons")[0]||this.createButtons(),this.gameWrapper.style.height=this.windowSize(),this.gameWrapper.style.width=this.windowSize(),this.listeners(e)},listeners:function(e){e.start&&(snakeGame.TouchListener(this.gameWrapper,e.start,!0),snakeGame.KeyboardListener(e.start,!0),snakeGame.ButtonListener(this.buttonWrapper,e.start,!0)),e.dir&&(snakeGame.TouchListener(this.gameWrapper,e.dir),snakeGame.KeyboardListener(e.dir),snakeGame.ButtonListener(this.buttonWrapper,e.dir))},windowSize:function(){return Math.min(window.innerWidth,window.innerHeight)-200},render:function(e,t){this.elements={},this.gameWrapper.innerHTML="",t&&this.addWelcome(t)
var n,i=Math.round(this.windowSize()/e.size),a=e.grid
for(coord in a)n=this.elements[a[coord].toPropKey()]=document.createElement("DIV"),n.classList.add("cell"),a[coord].value&&n.classList.add(a[coord].value),n.style.height=i,n.style.width=i,n.style.top=a[coord].y*i,n.style.left=a[coord].x*i,this.gameWrapper.appendChild(n)},createWrapper:function(){var e=document.createElement("snake-game")
return document.body.appendChild(e),e},createGameWrapper:function(){var e=document.createElement("game-display")
return this.snakeWrapper.appendChild(e),e},createButtons:function(){var e=document.createElement("game-buttons")
return this.snakeWrapper.appendChild(e),this.addButtons(e)},addButtons:function(e){var t=document.createElement("BUTTON"),n=document.createElement("BUTTON"),a=document.createElement("BUTTON"),s=document.createElement("BUTTON"),o=[t,a,s,n]
for(e.classList.add("snake-buttons"),e.style.height=100,e.style.width=this.windowSize(),e.style.margin="auto",i=0;i<4;i++)o[i].style.width=this.windowSize()/4-5,i<3&&(o[i].style.marginRight=5)
return t.innerHTML="&lArr;",n.innerHTML="&rArr;",a.innerHTML="&uArr;",s.innerHTML="&dArr;",t.setAttribute("direction","left"),n.setAttribute("direction","right"),a.setAttribute("direction","up"),s.setAttribute("direction","down"),e.appendChild(t),e.appendChild(a),e.appendChild(s),e.appendChild(n),e},addWelcome:function(e){var t=document.createElement("DIV")
t.innerHTML="<h1>"+(e||"")+"</h1><h3>Swipe, click the buttons at the bottom, or press one of the keyboard controls to begin</h3><h3>Keyboard Controls:</h3><ul><li>W, &uArr; = Up</li><li>A, &lArr; = Left</li><li>D, &rArr; = Right</li><li>S, &dArr; = Down</li></ul>",t.classList.add("welcome"),t.style.padding=this.windowSize()/4,this.gameWrapper.appendChild(t)},updateCells:function(e){for(var t=0;t<e.length;t++)this.updateCell(e[t])},updateCell:function(e){this.elements[e.toPropKey()].setAttribute("class","cell "+e.value)}},snakeGame.controller={init:function(e){var t=e||25
this.setReferences(),this.reset(t),this.view.init({dir:this.changeDirection,start:this.run}),this.view.render(this.board,"Welcome to Snake")},setReferences:function(){this.board=snakeGame.boardModel,this.snake=snakeGame.snakeModel,this.view=snakeGame.view},reset:function(e,t){this.snake.init(e),this.board.init(e,this.snake.snakeBody)},run:function(e){var t=snakeGame.controller
t.gameRunning||(console.log("Game Started"),t.gameRunning=!0,t.view.render(t.board),t.gameSpeed(1))},gameOver:function(){console.log("Game Over"),clearInterval(this.gameLoop),this.gameRunning=!1
var e=this
setTimeout(function(){e.reset(e.board.size),e.view.listeners({start:e.run})},200)},gameSpeed:function(e){clearInterval(this.gameLoop)
var t=snakeGame.controller
t.gameLoop=setInterval(function(){t.move()},2e3/(t.board.size+e))},move:function(){this.snake.changeDirection()
var e=this.board.checkNextPosition(this.snake.nextPostion())
if("crash"===e)this.view.render(this.board,"Game Over"),this.gameOver()
else{e&&this.gameSpeed(this.snake.snakeBody.length)
var t=this.snake.move(e)
this.board.unset(t),this.view.updateCells(this.board.changedCells),this.board.changedCells=[]}},changeDirection:function(e){var t={left:{x:-1,y:0},up:{y:-1,x:0},right:{x:1,y:0},down:{y:1,x:0}}[e]
t&&snakeGame.snakeModel.addDirChange(t)}}
